"use strict";
var observable_1 = require("data/observable");
var observable_array_1 = require("data/observable-array");
var firebase = require("nativescript-plugin-firebase");
var Page = require("ui/frame");
var Dare_1 = require("../Class/Dare/Dare");
var self;
var MainModel = (function (_super) {
    __extends(MainModel, _super);
    function MainModel() {
        _super.call(this);
        this.Dares = new observable_array_1.ObservableArray();
        this.User = null;
        this.Score = 0;
        //Vet ikke om denne fungerer
        firebase.keepInSync("/Dares", // which path in your Firebase needs to be kept in sync?
        true // set to false to disable this feature again
        ).then(function () {
            console.log("firebase.keepInSync is ON for /Dares");
        }, function (error) {
            console.log("firebase.keepInSync error: " + error);
        });
    }
    MainModel.prototype.GetDares = function () {
        var path;
        var onChildEvent = function (result) {
            if (result.type === "ChildRemoved") {
                self.DeleteDare(result.key);
            }
            if (result.type === "ChildAdded") {
                if (self.CheckIfDareAdded(result.key) == true) {
                    self.NewDare(result.key, result.value.Dare, result.value.From);
                }
            }
        };
        // listen to changes in the /users path
        path = "/Dares/" + this.User;
        firebase.addChildEventListener(onChildEvent, path);
        path = "";
    };
    MainModel.prototype.GetScore = function () {
        var onChildEvent = function (result) {
            self.SetUIScore(result.value);
        };
        var path = "/Users/" + this.User + "/Score";
        firebase.addValueEventListener(onChildEvent, path);
    };
    MainModel.prototype.CheckIfDareAdded = function (id) {
        var AddDare = true;
        for (var i = 0; i < this.Dares.length; i++) {
            if (this.Dares.getItem(i).Id === id) {
                AddDare = false;
            }
        }
        return AddDare;
    };
    MainModel.prototype.DeleteDare = function (id) {
        this.SetScore();
        for (var i = 0; i < this.Dares.length; i++) {
            if (this.Dares.getItem(i).Id === id) {
                this.Dares.splice(i, 1);
                break;
            }
        }
    };
    MainModel.prototype.NewDare = function (id, nDare, From) {
        this.Dares.push(new Dare_1.default(id, nDare, From, this.User));
    };
    MainModel.prototype.SendDare = function () {
        Page.topmost().navigate({
            moduleName: "Page/SendTo/SendTo",
            context: { Username: this.User, Dare: this.InputDare
            },
            transition: {
                name: "slideBottom",
                duration: 380,
                curve: "easeIn"
            },
            animated: true
        });
    };
    MainModel.prototype.SetApplication = function (Username) {
        self = this;
        this.User = Username;
        this.set("GUIUser", this.User);
        this.GetDares();
        this.GetScore();
    };
    MainModel.prototype.SetUIScore = function (AScore) {
        this.set("Score", AScore);
    };
    MainModel.prototype.SetScore = function () {
        var adding = 10;
        var Result = this.Score;
        Result = Result + adding;
        firebase.update('/Users/' + this.User, { 'Score': Result });
    };
    MainModel.prototype.GoToFriendsPage = function () {
        Page.topmost().navigate({
            moduleName: "Page/FriendsPage/Friends",
            context: { Username: this.User
            },
            transition: {
                name: "slideBottom",
                duration: 380,
                curve: "easeIn"
            },
            animated: true
        });
    };
    MainModel.prototype.Logout = function () {
        this.User = "";
        this.set("Username", "");
        this.set("InputDare", "");
        while (this.Dares.length > 0) {
            this.Dares.pop();
        }
        firebase.logout();
        Page.topmost().goBack();
    };
    return MainModel;
}(observable_1.Observable));
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = MainModel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFpbi1QYWdlLW1vZGVsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiTWFpbi1QYWdlLW1vZGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSwyQkFBMEIsaUJBQWlCLENBQUMsQ0FBQTtBQUM1QyxpQ0FBZ0MsdUJBQXVCLENBQUMsQ0FBQTtBQUN4RCxJQUFPLFFBQVEsV0FBVyw4QkFBOEIsQ0FBQyxDQUFDO0FBSTFELElBQU8sSUFBSSxXQUFXLFVBQVUsQ0FBQyxDQUFDO0FBQ2xDLHFCQUFpQixvQkFBb0IsQ0FBQyxDQUFBO0FBRXJDLElBQUksSUFBSSxDQUFDO0FBQ1Y7SUFBd0IsNkJBQVU7SUFROUI7UUFDSSxpQkFBTyxDQUFDO1FBQ1IsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLGtDQUFlLEVBQVEsQ0FBQztRQUN6QyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztRQUVmLDRCQUE0QjtRQUMxQixRQUFRLENBQUMsVUFBVSxDQUNoQixRQUFRLEVBQUUsd0RBQXdEO1FBQ2xFLElBQUksQ0FBTSw2Q0FBNkM7U0FDdkQsQ0FBQyxJQUFJLENBQ047WUFDSSxPQUFPLENBQUMsR0FBRyxDQUFDLHNDQUFzQyxDQUFDLENBQUM7UUFDeEQsQ0FBQyxFQUNELFVBQUMsS0FBSztZQUNOLE9BQU8sQ0FBQyxHQUFHLENBQUMsNkJBQTZCLEdBQUcsS0FBSyxDQUFDLENBQUM7UUFDdkQsQ0FBQyxDQUFDLENBQUM7SUFFWCxDQUFDO0lBRUcsNEJBQVEsR0FBUjtRQUVJLElBQUksSUFBWSxDQUFDO1FBQ2pCLElBQUksWUFBWSxHQUFHLFVBQVMsTUFBVTtZQUVsQyxFQUFFLENBQUEsQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFHLGNBQWMsQ0FBQyxDQUNoQyxDQUFDO2dCQUNHLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2hDLENBQUM7WUFD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O1FBQ2YsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUMsRUFBRSxDQUFDLENBQUM7UUFDeEIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUMsRUFBRSxDQUFDLENBQUM7UUFDekIsT0FBTSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQzNCLENBQUM7WUFDRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLENBQUM7UUFFRCxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUM7UUFFbEIsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQzVCLENBQUM7SUFFTCxnQkFBQztBQUFELENBQUMsQUF4S0QsQ0FBd0IsdUJBQVUsR0F3S2pDO0FBRUQ7a0JBQWUsU0FBUyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0eyBPYnNlcnZhYmxlIH0gZnJvbSBcImRhdGEvb2JzZXJ2YWJsZVwiO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZUFycmF5IH0gZnJvbSBcImRhdGEvb2JzZXJ2YWJsZS1hcnJheVwiO1xuaW1wb3J0IGZpcmViYXNlID0gcmVxdWlyZShcIm5hdGl2ZXNjcmlwdC1wbHVnaW4tZmlyZWJhc2VcIik7XG5pbXBvcnQgbGlzdFBpY2tlck1vZHVsZSA9IHJlcXVpcmUoXCJ1aS9saXN0LXBpY2tlclwiKTtcbmltcG9ydCB7RXZlbnREYXRhfSBmcm9tIFwiZGF0YS9vYnNlcnZhYmxlXCI7XG5cbmltcG9ydCBQYWdlID0gcmVxdWlyZShcInVpL2ZyYW1lXCIpO1xuaW1wb3J0IERhcmUgZnJvbSBcIi4uL0NsYXNzL0RhcmUvRGFyZVwiO1xuXG4gdmFyIHNlbGY7XG5jbGFzcyBNYWluTW9kZWwgZXh0ZW5kcyBPYnNlcnZhYmxle1xuICAgIERhcmVzOiBPYnNlcnZhYmxlQXJyYXk8RGFyZT47XG4gICAgVXNlcjogc3RyaW5nO1xuICAgIFVzZXJuYW1lOiBzdHJpbmc7XG4gICAgSW5wdXREYXJlOiBzdHJpbmc7XG4gICAgU2NvcmU6IG51bWJlcjtcblxuXG4gICAgY29uc3RydWN0b3IoKXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5EYXJlcyA9IG5ldyBPYnNlcnZhYmxlQXJyYXk8RGFyZT4oKTtcbiAgICAgICAgdGhpcy5Vc2VyID0gbnVsbDtcbiAgICAgICAgdGhpcy5TY29yZSA9IDA7XG4gICAgICAgXG4gICAgICAgIC8vVmV0IGlra2Ugb20gZGVubmUgZnVuZ2VyZXJcbiAgICAgICAgICBmaXJlYmFzZS5rZWVwSW5TeW5jKFxuICAgICAgICAgICAgIFwiL0RhcmVzXCIsIC8vIHdoaWNoIHBhdGggaW4geW91ciBGaXJlYmFzZSBuZWVkcyB0byBiZSBrZXB0IGluIHN5bmM/XG4gICAgICAgICAgICAgdHJ1ZSAgICAgIC8vIHNldCB0byBmYWxzZSB0byBkaXNhYmxlIHRoaXMgZmVhdHVyZSBhZ2FpblxuICAgICAgICAgICAgKS50aGVuKFxuICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZmlyZWJhc2Uua2VlcEluU3luYyBpcyBPTiBmb3IgL0RhcmVzXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJmaXJlYmFzZS5rZWVwSW5TeW5jIGVycm9yOiBcIiArIGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxufVxuICAgIFxuICAgIEdldERhcmVzKClcbiAgICB7XG4gICAgICAgIGxldCBwYXRoOiBzdHJpbmc7XG4gICAgICAgIHZhciBvbkNoaWxkRXZlbnQgPSBmdW5jdGlvbihyZXN1bHQ6YW55KSBcbiAgICAgICAge1xuICAgICAgICAgICAgaWYocmVzdWx0LnR5cGU9PT1cIkNoaWxkUmVtb3ZlZFwiKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNlbGYuRGVsZXRlRGFyZShyZXN1bHQua2V5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZXN1bHQudHlwZSA9PT0gXCJDaGlsZEFkZGVkXCIpIFxuICAgICAgICAgICAge1xuXG4gICAgICAgICAgICAgICAgaWYoc2VsZi5DaGVja0lmRGFyZUFkZGVkKHJlc3VsdC5rZXkpID09IHRydWUpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNlbGYuTmV3RGFyZShyZXN1bHQua2V5LCByZXN1bHQudmFsdWUuRGFyZSwgcmVzdWx0LnZhbHVlLkZyb20pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAgICAgLy8gbGlzdGVuIHRvIGNoYW5nZXMgaW4gdGhlIC91c2VycyBwYXRoXG4gICAgICAgICAgICBwYXRoID0gXCIvRGFyZXMvXCIrdGhpcy5Vc2VyO1xuICAgICAgICAgICAgZmlyZWJhc2UuYWRkQ2hpbGRFdmVudExpc3RlbmVyKG9uQ2hpbGRFdmVudCxwYXRoKTtcbiAgICAgICAgICAgIHBhdGggPSBcIlwiO1xuICAgIH1cbiAgICBHZXRTY29yZSgpXG4gICAgeyAgICBcbiAgICAgICAgdmFyIG9uQ2hpbGRFdmVudCA9IGZ1bmN0aW9uKHJlc3VsdDphbnkpIFxuICAgICAgICB7XG4gICAgICAgICAgICBzZWxmLlNldFVJU2NvcmUocmVzdWx0LnZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcGF0aCA9IFwiL1VzZXJzL1wiK3RoaXMuVXNlciArIFwiL1Njb3JlXCI7XG4gICAgICAgIGZpcmViYXNlLmFkZFZhbHVlRXZlbnRMaXN0ZW5lcihvbkNoaWxkRXZlbnQscGF0aCk7XG4gICAgfVxuXG4gICAgQ2hlY2tJZkRhcmVBZGRlZChpZDpzdHJpbmcpXG4gICAge1xuICAgICAgICB2YXIgQWRkRGFyZSA9IHRydWU7XG4gICAgICAgIGZvciAodmFyIGk9MDtpPHRoaXMuRGFyZXMubGVuZ3RoO2krKykgXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlmICh0aGlzLkRhcmVzLmdldEl0ZW0oaSkuSWQgPT09IGlkKSBcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBBZGREYXJlID0gZmFsc2U7XG4gICAgICAgICAgICB9ICAgXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIEFkZERhcmU7XG4gICAgfVxuICAgIFxuICAgIERlbGV0ZURhcmUoaWQ6c3RyaW5nKVxuICAgIHtcbiAgICAgICAgdGhpcy5TZXRTY29yZSgpO1xuICAgICAgICBmb3IgKHZhciBpPTA7aTx0aGlzLkRhcmVzLmxlbmd0aDtpKyspIFxuICAgICAgICB7XG4gICAgICAgICAgICBpZiAodGhpcy5EYXJlcy5nZXRJdGVtKGkpLklkID09PSBpZCkgXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdGhpcy5EYXJlcy5zcGxpY2UoaSwxKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIE5ld0RhcmUoaWQ6c3RyaW5nLCBuRGFyZTpzdHJpbmcsIEZyb206c3RyaW5nKVxuICAgIHtcbiAgICAgICAgdGhpcy5EYXJlcy5wdXNoKG5ldyBEYXJlKGlkLG5EYXJlLEZyb20sdGhpcy5Vc2VyKSk7XG4gICAgfVxuXG4gICAgU2VuZERhcmUoKVxuICAgIHsgXG4gICAgICAgIFBhZ2UudG9wbW9zdCgpLm5hdmlnYXRlKFxuICAgICAgICB7XG4gICAgICAgICAgICBtb2R1bGVOYW1lOiBcIlBhZ2UvU2VuZFRvL1NlbmRUb1wiLFxuICAgICAgICAgICAgY29udGV4dDp7VXNlcm5hbWU6IHRoaXMuVXNlciwgRGFyZTp0aGlzLklucHV0RGFyZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRyYW5zaXRpb246IHtcbiAgICAgICAgICAgICAgICBuYW1lOiBcInNsaWRlQm90dG9tXCIsXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDM4MCxcbiAgICAgICAgICAgICAgICBjdXJ2ZTogXCJlYXNlSW5cIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFuaW1hdGVkOiB0cnVlXG4gICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBTZXRBcHBsaWNhdGlvbihVc2VybmFtZTpzdHJpbmcpXG4gICAge1xuICAgICAgICBzZWxmID0gdGhpcztcbiAgICAgICAgdGhpcy5Vc2VyID0gVXNlcm5hbWU7XG4gICAgICAgIHRoaXMuc2V0KFwiR1VJVXNlclwiLHRoaXMuVXNlcik7XG4gICAgICAgIHRoaXMuR2V0RGFyZXMoKTtcbiAgICAgICAgdGhpcy5HZXRTY29yZSgpO1xuICAgIH1cblxuICBcbiAgICBTZXRVSVNjb3JlKEFTY29yZTpudW1iZXIpXG4gICAge1xuICAgICAgICB0aGlzLnNldChcIlNjb3JlXCIsIEFTY29yZSk7XG4gICAgfVxuXG4gICAgU2V0U2NvcmUoKVxuICAgIHtcbiAgICAgICAgbGV0IGFkZGluZyA9IDEwO1xuICAgICAgICB2YXIgUmVzdWx0ID0gdGhpcy5TY29yZTtcbiAgICAgICBcbiAgICAgICAgUmVzdWx0ID0gUmVzdWx0ICsgYWRkaW5nO1xuICAgICAgICBmaXJlYmFzZS51cGRhdGUoXG4gICAgICAgICAgICAnL1VzZXJzLycgKyB0aGlzLlVzZXIsXG4gICAgICAgICAgICB7J1Njb3JlJzogUmVzdWx0fVxuICAgICAgICApO1xuICAgIH1cblxuICAgIEdvVG9GcmllbmRzUGFnZSgpXG4gICAge1xuICAgICAgICBQYWdlLnRvcG1vc3QoKS5uYXZpZ2F0ZShcbiAgICAgICAge1xuICAgICAgICAgICAgbW9kdWxlTmFtZTogXCJQYWdlL0ZyaWVuZHNQYWdlL0ZyaWVuZHNcIixcbiAgICAgICAgICAgICBjb250ZXh0OntVc2VybmFtZTogdGhpcy5Vc2VyXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRyYW5zaXRpb246IHtcbiAgICAgICAgICAgICAgICBuYW1lOiBcInNsaWRlQm90dG9tXCIsXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDM4MCxcbiAgICAgICAgICAgICAgICBjdXJ2ZTogXCJlYXNlSW5cIlxuICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhbmltYXRlZDogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBMb2dvdXQoKVxuICAgIHtcbiAgICAgICAgdGhpcy5Vc2VyID0gXCJcIjtcbiAgICAgICAgdGhpcy5zZXQoXCJVc2VybmFtZVwiLFwiXCIpO1xuICAgICAgICB0aGlzLnNldChcIklucHV0RGFyZVwiLFwiXCIpO1xuICAgICAgICB3aGlsZSh0aGlzLkRhcmVzLmxlbmd0aCA+IDApXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRoaXMuRGFyZXMucG9wKCk7XG4gICAgICAgIH1cblxuICAgICAgICBmaXJlYmFzZS5sb2dvdXQoKTtcbiAgICAgICAgXG4gICAgICAgIFBhZ2UudG9wbW9zdCgpLmdvQmFjaygpO1xuICAgIH1cbiAgXG59IFxuXG5leHBvcnQgZGVmYXVsdCBNYWluTW9kZWw7Il19