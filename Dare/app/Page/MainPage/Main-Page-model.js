"use strict";
var observable_1 = require("data/observable");
var observable_array_1 = require("data/observable-array");
var firebase = require("nativescript-plugin-firebase");
var Page = require("ui/frame");
var Dare_1 = require("../Class/Dare/Dare");
var self;
var MainModel = (function (_super) {
    __extends(MainModel, _super);
    function MainModel() {
        _super.call(this);
        this.Dares = new observable_array_1.ObservableArray();
        this.User = null;
        this.Score = 0;
        //Vet ikke om denne fungerer
        firebase.keepInSync("/Dares", // which path in your Firebase needs to be kept in sync?
        true // set to false to disable this feature again
        ).then(function () {
            console.log("firebase.keepInSync is ON for /Dares");
        }, function (error) {
            console.log("firebase.keepInSync error: " + error);
        });
    }
    MainModel.prototype.GetDares = function () {
        var path;
        var onChildEvent = function (result) {
            if (result.type === "ChildRemoved") {
                self.DeleteDare(result.key);
            }
            if (result.type === "ChildAdded") {
                if (self.CheckIfDareAdded(result.key) == true) {
                    self.NewDare(result.key, result.value.Dare, result.value.From);
                }
            }
        };
        // listen to changes in the /users path
        path = "/Dares/" + this.User;
        firebase.addChildEventListener(onChildEvent, path);
        path = "";
    };
    MainModel.prototype.GetScore = function () {
        var onChildEvent = function (result) {
            self.SetUIScore(result.value);
        };
        var path = "/Users/" + this.User + "/Score";
        firebase.addValueEventListener(onChildEvent, path);
    };
    MainModel.prototype.CheckIfDareAdded = function (id) {
        var AddDare = true;
        for (var i = 0; i < this.Dares.length; i++) {
            if (this.Dares.getItem(i).Id === id) {
                AddDare = false;
            }
        }
        return AddDare;
    };
    MainModel.prototype.DeleteDare = function (id) {
        this.SetScore();
        for (var i = 0; i < this.Dares.length; i++) {
            if (this.Dares.getItem(i).Id === id) {
                this.Dares.splice(i, 1);
                break;
            }
        }
    };
    MainModel.prototype.NewDare = function (id, nDare, From) {
        this.Dares.push(new Dare_1.default(id, nDare, From, this.User));
    };
    MainModel.prototype.SendDare = function () {
        Page.topmost().navigate({
            moduleName: "Page/SendTo/SendTo",
            context: { Username: this.User, Dare: this.InputDare
            },
            transition: {
                name: "slideBottom",
                duration: 380,
                curve: "easeIn"
            },
            animated: true
        });
    };
    MainModel.prototype.SetApplication = function (Username) {
        self = this;
        this.User = Username;
        this.set("GUIUser", this.User);
        this.GetDares();
        this.GetScore();
    };
    MainModel.prototype.SetUIScore = function (AScore) {
        this.set("Score", AScore);
    };
    MainModel.prototype.SetScore = function () {
        var adding = 10;
        var Result = this.Score;
        Result = Result + adding;
        firebase.update('/Users/' + this.User, { 'Score': Result });
    };
    MainModel.prototype.GoToFriendsPage = function () {
        Page.topmost().navigate({
            moduleName: "Page/FriendsPage/Friends",
            context: { Username: this.User
            },
            transition: {
                name: "slideBottom",
                duration: 380,
                curve: "easeIn"
            },
            animated: true
        });
    };
    MainModel.prototype.Logout = function () {
        this.User = "";
        this.set("Username", "");
        this.set("InputDare", "");
        while (this.Dares.length > 0) {
            this.Dares.pop();
        }
        firebase.logout();
        Page.topmost().goBack();
    };
    return MainModel;
}(observable_1.Observable));
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = MainModel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFpbi1QYWdlLW1vZGVsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiTWFpbi1QYWdlLW1vZGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSwyQkFBMEIsaUJBQWlCLENBQUMsQ0FBQTtBQUM1QyxpQ0FBZ0MsdUJBQXVCLENBQUMsQ0FBQTtBQUN4RCxJQUFPLFFBQVEsV0FBVyw4QkFBOEIsQ0FBQyxDQUFDO0FBSTFELElBQU8sSUFBSSxXQUFXLFVBQVUsQ0FBQyxDQUFDO0FBQ2xDLHFCQUFpQixvQkFBb0IsQ0FBQyxDQUFBO0FBRXJDLElBQUksSUFBSSxDQUFDO0FBQ1Y7SUFBd0IsNkJBQVU7SUFROUI7UUFDSSxpQkFBTyxDQUFDO1FBQ1IsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLGtDQUFlLEVBQVEsQ0FBQztRQUN6QyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztRQUVmLDRCQUE0QjtRQUMxQixRQUFRLENBQUMsVUFBVSxDQUNoQixRQUFRLEVBQUUsd0RBQXdEO1FBQ2xFLElBQUksQ0FBTSw2Q0FBNkM7U0FDdkQsQ0FBQyxJQUFJLENBQ047WUFDSSxPQUFPLENBQUMsR0FBRyxDQUFDLHNDQUFzQyxDQUFDLENBQUM7UUFDeEQsQ0FBQyxFQUNELFVBQUMsS0FBSztZQUNOLE9BQU8sQ0FBQyxHQUFHLENBQUMsNkJBQTZCLEdBQUcsS0FBSyxDQUFDLENBQUM7UUFDdkQsQ0FBQyxDQUFDLENBQUM7SUFFWCxDQUFDO0lBRUcsNEJBQVEsR0FBUjtRQUVJLElBQUksSUFBWSxDQUFDO1FBQ2pCLElBQUksWUFBWSxHQUFHLFVBQVMsTUFBVTtZQUVsQyxFQUFFLENBQUEsQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFHLGNBQWMsQ0FBQyxDQUNoQyxDQUFDO2dCQUNHLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2hDLENBQUM7WUFD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O1FBQ2YsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUMsRUFBRSxDQUFDLENBQUM7UUFDeEIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUMsRUFBRSxDQUFDLENBQUM7UUFDekIsT0FBTSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQzNCLENBQUM7WUFDRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLENBQUM7UUFFRCxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUM7UUFFbEIsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQzVCLENBQUM7SUFFTCxnQkFBQztBQUFELENBQUMsQUF4S0QsQ0FBd0IsdUJBQVUsR0F3S2pDO0FBRUQ7a0JBQWUsU0FBUyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0eyBPYnNlcnZhYmxlIH0gZnJvbSBcImRhdGEvb2JzZXJ2YWJsZVwiO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlQXJyYXkgfSBmcm9tIFwiZGF0YS9vYnNlcnZhYmxlLWFycmF5XCI7XHJcbmltcG9ydCBmaXJlYmFzZSA9IHJlcXVpcmUoXCJuYXRpdmVzY3JpcHQtcGx1Z2luLWZpcmViYXNlXCIpO1xyXG5pbXBvcnQgbGlzdFBpY2tlck1vZHVsZSA9IHJlcXVpcmUoXCJ1aS9saXN0LXBpY2tlclwiKTtcclxuaW1wb3J0IHtFdmVudERhdGF9IGZyb20gXCJkYXRhL29ic2VydmFibGVcIjtcclxuXHJcbmltcG9ydCBQYWdlID0gcmVxdWlyZShcInVpL2ZyYW1lXCIpO1xyXG5pbXBvcnQgRGFyZSBmcm9tIFwiLi4vQ2xhc3MvRGFyZS9EYXJlXCI7XHJcblxyXG4gdmFyIHNlbGY7XHJcbmNsYXNzIE1haW5Nb2RlbCBleHRlbmRzIE9ic2VydmFibGV7XHJcbiAgICBEYXJlczogT2JzZXJ2YWJsZUFycmF5PERhcmU+O1xyXG4gICAgVXNlcjogc3RyaW5nO1xyXG4gICAgVXNlcm5hbWU6IHN0cmluZztcclxuICAgIElucHV0RGFyZTogc3RyaW5nO1xyXG4gICAgU2NvcmU6IG51bWJlcjtcclxuXHJcblxyXG4gICAgY29uc3RydWN0b3IoKXtcclxuICAgICAgICBzdXBlcigpO1xyXG4gICAgICAgIHRoaXMuRGFyZXMgPSBuZXcgT2JzZXJ2YWJsZUFycmF5PERhcmU+KCk7XHJcbiAgICAgICAgdGhpcy5Vc2VyID0gbnVsbDtcclxuICAgICAgICB0aGlzLlNjb3JlID0gMDtcclxuICAgICAgIFxyXG4gICAgICAgIC8vVmV0IGlra2Ugb20gZGVubmUgZnVuZ2VyZXJcclxuICAgICAgICAgIGZpcmViYXNlLmtlZXBJblN5bmMoXHJcbiAgICAgICAgICAgICBcIi9EYXJlc1wiLCAvLyB3aGljaCBwYXRoIGluIHlvdXIgRmlyZWJhc2UgbmVlZHMgdG8gYmUga2VwdCBpbiBzeW5jP1xyXG4gICAgICAgICAgICAgdHJ1ZSAgICAgIC8vIHNldCB0byBmYWxzZSB0byBkaXNhYmxlIHRoaXMgZmVhdHVyZSBhZ2FpblxyXG4gICAgICAgICAgICApLnRoZW4oXHJcbiAgICAgICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZmlyZWJhc2Uua2VlcEluU3luYyBpcyBPTiBmb3IgL0RhcmVzXCIpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAoZXJyb3IpID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJmaXJlYmFzZS5rZWVwSW5TeW5jIGVycm9yOiBcIiArIGVycm9yKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxufVxyXG4gICAgXHJcbiAgICBHZXREYXJlcygpXHJcbiAgICB7XHJcbiAgICAgICAgbGV0IHBhdGg6IHN0cmluZztcclxuICAgICAgICB2YXIgb25DaGlsZEV2ZW50ID0gZnVuY3Rpb24ocmVzdWx0OmFueSkgXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZihyZXN1bHQudHlwZT09PVwiQ2hpbGRSZW1vdmVkXCIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuRGVsZXRlRGFyZShyZXN1bHQua2V5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocmVzdWx0LnR5cGUgPT09IFwiQ2hpbGRBZGRlZFwiKSBcclxuICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmKHNlbGYuQ2hlY2tJZkRhcmVBZGRlZChyZXN1bHQua2V5KSA9PSB0cnVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgc2VsZi5OZXdEYXJlKHJlc3VsdC5rZXksIHJlc3VsdC52YWx1ZS5EYXJlLCByZXN1bHQudmFsdWUuRnJvbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGxpc3RlbiB0byBjaGFuZ2VzIGluIHRoZSAvdXNlcnMgcGF0aFxyXG4gICAgICAgICAgICBwYXRoID0gXCIvRGFyZXMvXCIrdGhpcy5Vc2VyO1xyXG4gICAgICAgICAgICBmaXJlYmFzZS5hZGRDaGlsZEV2ZW50TGlzdGVuZXIob25DaGlsZEV2ZW50LHBhdGgpO1xyXG4gICAgICAgICAgICBwYXRoID0gXCJcIjtcclxuICAgIH1cclxuICAgIEdldFNjb3JlKClcclxuICAgIHsgICAgXHJcbiAgICAgICAgdmFyIG9uQ2hpbGRFdmVudCA9IGZ1bmN0aW9uKHJlc3VsdDphbnkpIFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgc2VsZi5TZXRVSVNjb3JlKHJlc3VsdC52YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBwYXRoID0gXCIvVXNlcnMvXCIrdGhpcy5Vc2VyICsgXCIvU2NvcmVcIjtcclxuICAgICAgICBmaXJlYmFzZS5hZGRWYWx1ZUV2ZW50TGlzdGVuZXIob25DaGlsZEV2ZW50LHBhdGgpO1xyXG4gICAgfVxyXG5cclxuICAgIENoZWNrSWZEYXJlQWRkZWQoaWQ6c3RyaW5nKVxyXG4gICAge1xyXG4gICAgICAgIHZhciBBZGREYXJlID0gdHJ1ZTtcclxuICAgICAgICBmb3IgKHZhciBpPTA7aTx0aGlzLkRhcmVzLmxlbmd0aDtpKyspIFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuRGFyZXMuZ2V0SXRlbShpKS5JZCA9PT0gaWQpIFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBZGREYXJlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0gICBcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIEFkZERhcmU7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIERlbGV0ZURhcmUoaWQ6c3RyaW5nKVxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuU2V0U2NvcmUoKTtcclxuICAgICAgICBmb3IgKHZhciBpPTA7aTx0aGlzLkRhcmVzLmxlbmd0aDtpKyspIFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuRGFyZXMuZ2V0SXRlbShpKS5JZCA9PT0gaWQpIFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLkRhcmVzLnNwbGljZShpLDEpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgTmV3RGFyZShpZDpzdHJpbmcsIG5EYXJlOnN0cmluZywgRnJvbTpzdHJpbmcpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5EYXJlcy5wdXNoKG5ldyBEYXJlKGlkLG5EYXJlLEZyb20sdGhpcy5Vc2VyKSk7XHJcbiAgICB9XHJcblxyXG4gICAgU2VuZERhcmUoKVxyXG4gICAgeyBcclxuICAgICAgICBQYWdlLnRvcG1vc3QoKS5uYXZpZ2F0ZShcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIG1vZHVsZU5hbWU6IFwiUGFnZS9TZW5kVG8vU2VuZFRvXCIsXHJcbiAgICAgICAgICAgIGNvbnRleHQ6e1VzZXJuYW1lOiB0aGlzLlVzZXIsIERhcmU6dGhpcy5JbnB1dERhcmVcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdHJhbnNpdGlvbjoge1xyXG4gICAgICAgICAgICAgICAgbmFtZTogXCJzbGlkZUJvdHRvbVwiLFxyXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDM4MCxcclxuICAgICAgICAgICAgICAgIGN1cnZlOiBcImVhc2VJblwiXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGFuaW1hdGVkOiB0cnVlXHJcbiAgICAgICAgfVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgU2V0QXBwbGljYXRpb24oVXNlcm5hbWU6c3RyaW5nKVxyXG4gICAge1xyXG4gICAgICAgIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuVXNlciA9IFVzZXJuYW1lO1xyXG4gICAgICAgIHRoaXMuc2V0KFwiR1VJVXNlclwiLHRoaXMuVXNlcik7XHJcbiAgICAgICAgdGhpcy5HZXREYXJlcygpO1xyXG4gICAgICAgIHRoaXMuR2V0U2NvcmUoKTtcclxuICAgIH1cclxuXHJcbiAgXHJcbiAgICBTZXRVSVNjb3JlKEFTY29yZTpudW1iZXIpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5zZXQoXCJTY29yZVwiLCBBU2NvcmUpO1xyXG4gICAgfVxyXG5cclxuICAgIFNldFNjb3JlKClcclxuICAgIHtcclxuICAgICAgICBsZXQgYWRkaW5nID0gMTA7XHJcbiAgICAgICAgdmFyIFJlc3VsdCA9IHRoaXMuU2NvcmU7XHJcbiAgICAgICBcclxuICAgICAgICBSZXN1bHQgPSBSZXN1bHQgKyBhZGRpbmc7XHJcbiAgICAgICAgZmlyZWJhc2UudXBkYXRlKFxyXG4gICAgICAgICAgICAnL1VzZXJzLycgKyB0aGlzLlVzZXIsXHJcbiAgICAgICAgICAgIHsnU2NvcmUnOiBSZXN1bHR9XHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBHb1RvRnJpZW5kc1BhZ2UoKVxyXG4gICAge1xyXG4gICAgICAgIFBhZ2UudG9wbW9zdCgpLm5hdmlnYXRlKFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbW9kdWxlTmFtZTogXCJQYWdlL0ZyaWVuZHNQYWdlL0ZyaWVuZHNcIixcclxuICAgICAgICAgICAgIGNvbnRleHQ6e1VzZXJuYW1lOiB0aGlzLlVzZXJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRyYW5zaXRpb246IHtcclxuICAgICAgICAgICAgICAgIG5hbWU6IFwic2xpZGVCb3R0b21cIixcclxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAzODAsXHJcbiAgICAgICAgICAgICAgICBjdXJ2ZTogXCJlYXNlSW5cIlxyXG4gICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgYW5pbWF0ZWQ6IHRydWVcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIExvZ291dCgpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5Vc2VyID0gXCJcIjtcclxuICAgICAgICB0aGlzLnNldChcIlVzZXJuYW1lXCIsXCJcIik7XHJcbiAgICAgICAgdGhpcy5zZXQoXCJJbnB1dERhcmVcIixcIlwiKTtcclxuICAgICAgICB3aGlsZSh0aGlzLkRhcmVzLmxlbmd0aCA+IDApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLkRhcmVzLnBvcCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZmlyZWJhc2UubG9nb3V0KCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgUGFnZS50b3Btb3N0KCkuZ29CYWNrKCk7XHJcbiAgICB9XHJcbiAgXHJcbn0gXHJcblxyXG5leHBvcnQgZGVmYXVsdCBNYWluTW9kZWw7Il19