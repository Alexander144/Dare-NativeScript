"use strict";
var observable_1 = require("data/observable");
var observable_array_1 = require("data/observable-array");
var firebase = require("nativescript-plugin-firebase");
var Page = require("ui/frame");
var Friend_1 = require("../Class/Friend/Friend");
var self;
var MainModel = (function (_super) {
    __extends(MainModel, _super);
    function MainModel() {
        _super.call(this);
        this.Friends = new observable_array_1.ObservableArray();
        //Vet ikke om denne fungerer
        firebase.keepInSync("/Dares", // which path in your Firebase needs to be kept in sync?
        true // set to false to disable this feature again
        ).then(function () {
            console.log("firebase.keepInSync is ON for /Dares");
        }, function (error) {
            console.log("firebase.keepInSync error: " + error);
        });
    }
    MainModel.prototype.Send = function () {
        for (var i = 0; i < this.Friends.length; i++) {
            if (this.Friends.getItem(i).SelectedFriend === true) {
                this.Friends.getItem(i).Send(this.Dare);
            }
        }
        Page.topmost().goBack();
    };
    MainModel.prototype.SetApplication = function (Username, Dare) {
        self = this;
        this.User = Username;
        this.Dare = Dare;
        this.set("SUser", this.User);
        if (this.SetFriends(this.User)) {
            this.Friends.push(new Friend_1.default(this.User, this.User, true));
        }
        this.GetFriends();
    };
    MainModel.prototype.GetFriends = function () {
        var onChildEvent = function (result) {
            if (result.type === "ChildAdded") {
                if (self.SetFriends(result.key) == true) {
                    self.AddFriendsToList(result.key);
                }
            }
            if (result.type === "ChildRemoved") {
                self.DeleteFriend(result.key);
            }
        };
        console.log("User" + this.User);
        var pathToFriends = "/Users/" + this.User + "/Friends/Accept";
        firebase.addChildEventListener(onChildEvent, pathToFriends);
    };
    MainModel.prototype.SetFriends = function (AFriend) {
        var AddFriend = true;
        //Kan bytte til .indexof. SÃ¸ker igjennom array hvor elemente du vl ha ligger
        for (var i = 0; i < this.Friends.length; i++) {
            if (this.Friends.getItem(i).FriendsUsername === AFriend) {
                AddFriend = false;
            }
        }
        return AddFriend;
    };
    MainModel.prototype.AddFriendsToList = function (AFriend) {
        this.Friends.push(new Friend_1.default(this.User, AFriend, true));
        console.log("Key:" + AFriend);
    };
    MainModel.prototype.GoBack = function () {
        while (this.Friends.length > 0) {
            this.Friends.pop();
        }
        Page.topmost().goBack();
    };
    return MainModel;
}(observable_1.Observable));
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = MainModel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2VuZFRvLW1vZGVsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU2VuZFRvLW1vZGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSwyQkFBMEIsaUJBQWlCLENBQUMsQ0FBQTtBQUM1QyxpQ0FBZ0MsdUJBQXVCLENBQUMsQ0FBQTtBQUN4RCxJQUFPLFFBQVEsV0FBVyw4QkFBOEIsQ0FBQyxDQUFDO0FBSTFELElBQU8sSUFBSSxXQUFXLFVBQVUsQ0FBQyxDQUFDO0FBRWxDLHVCQUFtQix3QkFBd0IsQ0FBQyxDQUFBO0FBRTNDLElBQUksSUFBSSxDQUFDO0FBQ1Y7SUFBd0IsNkJBQVU7SUFPOUI7UUFDSSxpQkFBTyxDQUFDO1FBQ1AsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLGtDQUFlLEVBQVUsQ0FBQztRQUM5Qyw0QkFBNEI7UUFDMUIsUUFBUSxDQUFDLFVBQVUsQ0FDaEIsUUFBUSxFQUFFLHdEQUF3RDtRQUNsRSxJQUFJLENBQU0sNkNBQTZDO1NBQ3ZELENBQUMsSUFBSSxDQUNOO1lBQ0ksT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO1FBQ3hELENBQUMsRUFDRCxVQUFDLEtBQUs7WUFDTixPQUFPLENBQUMsR0FBRyxDQUFDLDZCQUE2QixHQUFHLEtBQUssQ0FBQyxDQUFDO1FBQ3ZELENBQUMsQ0FBQyxDQUFDO0lBRVgsQ0FBQztJQUVHLHdCQUFJLEdBQUo7UUFDSyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBQyxDQUFDLEVBQUMsQ0FBQyxHQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFDLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDdEMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsY0FBYyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQ2xELElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLElB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UUFDdkIsQ0FBQztRQUNBLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUM3QixDQUFDO0lBRUwsZ0JBQUM7QUFBRCxDQUFDLEFBakZELENBQXdCLHVCQUFVLEdBaUZqQztBQUVEO2tCQUFlLFNBQVMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydHsgT2JzZXJ2YWJsZSB9IGZyb20gXCJkYXRhL29ic2VydmFibGVcIjtcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZUFycmF5IH0gZnJvbSBcImRhdGEvb2JzZXJ2YWJsZS1hcnJheVwiO1xyXG5pbXBvcnQgZmlyZWJhc2UgPSByZXF1aXJlKFwibmF0aXZlc2NyaXB0LXBsdWdpbi1maXJlYmFzZVwiKTtcclxuaW1wb3J0IGxpc3RQaWNrZXJNb2R1bGUgPSByZXF1aXJlKFwidWkvbGlzdC1waWNrZXJcIik7XHJcbmltcG9ydCB7RXZlbnREYXRhfSBmcm9tIFwiZGF0YS9vYnNlcnZhYmxlXCI7XHJcblxyXG5pbXBvcnQgUGFnZSA9IHJlcXVpcmUoXCJ1aS9mcmFtZVwiKTtcclxuaW1wb3J0IERhcmUgZnJvbSBcIi4uL0NsYXNzL0RhcmUvRGFyZVwiO1xyXG5pbXBvcnQgRnJpZW5kIGZyb20gXCIuLi9DbGFzcy9GcmllbmQvRnJpZW5kXCI7XHJcblxyXG4gdmFyIHNlbGY7XHJcbmNsYXNzIE1haW5Nb2RlbCBleHRlbmRzIE9ic2VydmFibGV7XHJcbiAgICBVc2VyOiBzdHJpbmc7XHJcbiAgICBEYXJlOiBzdHJpbmc7XHJcbiAgICBpbmRleDogbnVtYmVyO1xyXG4gICAgRnJpZW5kczogT2JzZXJ2YWJsZUFycmF5PEZyaWVuZD47XHJcbiAgXHJcblxyXG4gICAgY29uc3RydWN0b3IoKXtcclxuICAgICAgICBzdXBlcigpO1xyXG4gICAgICAgICB0aGlzLkZyaWVuZHMgPSBuZXcgT2JzZXJ2YWJsZUFycmF5PEZyaWVuZD4oKTtcclxuICAgICAgICAvL1ZldCBpa2tlIG9tIGRlbm5lIGZ1bmdlcmVyXHJcbiAgICAgICAgICBmaXJlYmFzZS5rZWVwSW5TeW5jKFxyXG4gICAgICAgICAgICAgXCIvRGFyZXNcIiwgLy8gd2hpY2ggcGF0aCBpbiB5b3VyIEZpcmViYXNlIG5lZWRzIHRvIGJlIGtlcHQgaW4gc3luYz9cclxuICAgICAgICAgICAgIHRydWUgICAgICAvLyBzZXQgdG8gZmFsc2UgdG8gZGlzYWJsZSB0aGlzIGZlYXR1cmUgYWdhaW5cclxuICAgICAgICAgICAgKS50aGVuKFxyXG4gICAgICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImZpcmViYXNlLmtlZXBJblN5bmMgaXMgT04gZm9yIC9EYXJlc1wiKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZmlyZWJhc2Uua2VlcEluU3luYyBlcnJvcjogXCIgKyBlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbn1cclxuXHJcbiAgICBTZW5kKCl7XHJcbiAgICAgICAgIGZvciAodmFyIGk9MDtpPHRoaXMuRnJpZW5kcy5sZW5ndGg7aSsrKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLkZyaWVuZHMuZ2V0SXRlbShpKS5TZWxlY3RlZEZyaWVuZCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5GcmllbmRzLmdldEl0ZW0oaSkuU2VuZCh0aGlzLkRhcmUpO1xyXG4gICAgICAgICAgICAgfSAgIFxyXG4gICAgICAgIH1cclxuICAgICAgICBQYWdlLnRvcG1vc3QoKS5nb0JhY2soKTtcclxuICAgIH1cclxuXHJcbiAgICBTZXRBcHBsaWNhdGlvbihVc2VybmFtZTpzdHJpbmcsIERhcmU6c3RyaW5nKXtcclxuICAgICAgICBzZWxmID0gdGhpcztcclxuICAgICAgICB0aGlzLlVzZXIgPSBVc2VybmFtZTtcclxuICAgICAgICB0aGlzLkRhcmUgPSBEYXJlO1xyXG4gICAgICAgIHRoaXMuc2V0KFwiU1VzZXJcIix0aGlzLlVzZXIpO1xyXG4gICAgICAgIGlmKHRoaXMuU2V0RnJpZW5kcyh0aGlzLlVzZXIpKXtcclxuICAgICAgICAgICAgdGhpcy5GcmllbmRzLnB1c2gobmV3IEZyaWVuZCh0aGlzLlVzZXIsdGhpcy5Vc2VyLHRydWUpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5HZXRGcmllbmRzKCk7XHJcbiAgICB9XHJcbiAgICBHZXRGcmllbmRzKCl7XHJcbiAgICAgICAgICAgdmFyIG9uQ2hpbGRFdmVudCA9IGZ1bmN0aW9uKHJlc3VsdDphbnkpIHtcclxuICAgICAgICAgICAgIGlmKHJlc3VsdC50eXBlID09PSBcIkNoaWxkQWRkZWRcIil7XHJcbiAgICAgICAgICAgICAgICAgaWYoc2VsZi5TZXRGcmllbmRzKHJlc3VsdC5rZXkpID09IHRydWUpe1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuQWRkRnJpZW5kc1RvTGlzdChyZXN1bHQua2V5KTtcclxuICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgaWYocmVzdWx0LnR5cGUgPT09IFwiQ2hpbGRSZW1vdmVkXCIpe1xyXG4gICAgICAgICAgICAgICAgICBzZWxmLkRlbGV0ZUZyaWVuZChyZXN1bHQua2V5KTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJVc2VyXCIgKyB0aGlzLlVzZXIpO1xyXG4gICAgICAgIGxldCBwYXRoVG9GcmllbmRzID0gXCIvVXNlcnMvXCIrdGhpcy5Vc2VyICsgXCIvRnJpZW5kcy9BY2NlcHRcIjtcclxuICAgICAgICBmaXJlYmFzZS5hZGRDaGlsZEV2ZW50TGlzdGVuZXIob25DaGlsZEV2ZW50LHBhdGhUb0ZyaWVuZHMpO1xyXG4gICAgfVxyXG4gICAgU2V0RnJpZW5kcyhBRnJpZW5kOiBzdHJpbmcpe1xyXG4gICAgdmFyIEFkZEZyaWVuZCA9IHRydWU7XHJcbiAgICAvL0thbiBieXR0ZSB0aWwgLmluZGV4b2YuIFPDuGtlciBpZ2plbm5vbSBhcnJheSBodm9yIGVsZW1lbnRlIGR1IHZsIGhhIGxpZ2dlclxyXG4gICAgZm9yICh2YXIgaT0wO2k8dGhpcy5GcmllbmRzLmxlbmd0aDtpKyspIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuRnJpZW5kcy5nZXRJdGVtKGkpLkZyaWVuZHNVc2VybmFtZSA9PT0gQUZyaWVuZCkge1xyXG4gICAgICAgICAgICAgICAgQWRkRnJpZW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgICB9ICAgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBBZGRGcmllbmQ7XHJcbiAgICB9XHJcbiAgICBBZGRGcmllbmRzVG9MaXN0KEFGcmllbmQ6c3RyaW5nKXtcclxuICAgICAgICB0aGlzLkZyaWVuZHMucHVzaChuZXcgRnJpZW5kKHRoaXMuVXNlcixBRnJpZW5kLHRydWUpKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIktleTpcIiArIEFGcmllbmQpO1xyXG4gICAgfVxyXG5cclxuICBcclxuICAgR29CYWNrKCl7XHJcbiAgICAgICAgIHdoaWxlKHRoaXMuRnJpZW5kcy5sZW5ndGggPiAwKXtcclxuICAgICAgICAgICAgdGhpcy5GcmllbmRzLnBvcCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAgUGFnZS50b3Btb3N0KCkuZ29CYWNrKCk7XHJcbiAgICB9XHJcbiAgXHJcbn0gXHJcblxyXG5leHBvcnQgZGVmYXVsdCBNYWluTW9kZWw7Il19